// Generated by CoffeeScript 1.3.3
(function() {

  wiki.registerPlugin('changes', function($) {
    return {
      emit: function(div, item) {
        var i, slug, ul, wikiPage, _i, _ref, _results;
        div.append(ul = $('<ul />'));
        if (localStorage.length === 0) {
          ul.append('<p>no local changes</p>');
        }
        _results = [];
        for (i = _i = 0, _ref = localStorage.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          slug = localStorage.key(i);
          wikiPage = JSON.parse(localStorage[slug]);
          _results.push(ul.prepend("<li>\n  <a class=\"internal\" href=\"#\" title=\"origin\" data-page-name=\"" + slug + "\"> \n    " + wikiPage.title + "\n  </a> \n  <button>X</button>\n</li>"));
        }
        return _results;
      },
      bind: function(div, item) {
        return div.find('button').click(function() {
          var slug;
          slug = $(this).siblings('a.internal').data('pageName');
          console.log(['deleting', slug]);
          localStorage.removeItem(slug);
          return plugin["do"](div.empty(), item);
        });
      }
    };
  });

}).call(this);
